---
title: "超越权限提示：让 Claude Code 更安全、更自主"
url: "https://claude.com/blog/beyond-permission-prompts-making-claude-code-more-secure-and-autonomous"
---

# 超越权限提示：让 Claude Code 更安全、更自主

为了帮助解决这个问题，我们在 Claude Code 中引入了两项基于沙盒构建的新功能，这两项功能都旨在为开发者提供一个更安全的工作环境，同时也允许 Claude 更加自主地运行，减少权限提示。通过定义 Claude 可以自由工作的设定边界，这些功能作为**原生沙盒**的示例，提高了安全性和代理能力。

## 我们当前保护用户安全的方法

Claude Code 运行在基于权限的模型上：默认情况下，它是只读的，这意味着它在进行修改或运行任何命令之前会请求许可。这有一些例外：我们使用静态分析来自动允许像 echo 或 cat 这样的安全命令，但大多数操作仍然需要明确批准。

但是，不断点击“批准”会减慢开发速度，并可能导致“批准疲劳”，用户可能不再密切关注他们正在批准的内容。为了使 Claude Code 既安全又更有效，我们希望找到一种更好的方法。

## 沙盒：一种更安全、更自主的方法

沙盒创建了预定义的边界，Claude 可以在其中更自由地工作，而不是针对每个动作请求许可。

随着我们对 Claude Code 的更新，我们正在转向这种方法。我们的沙盒方法建立在操作系统级功能之上，以启用两个新功能，每个功能都基于以下两组边界：

1.  **文件系统隔离**，确保 Claude 只能访问或修改特定目录。这对于防止被提示词注入的 Claude 修改敏感系统文件尤为重要。
2.  **网络隔离**，确保 Claude 只能连接到批准的服务器。这防止了被提示词注入的 Claude 泄露敏感信息或下载恶意软件。

值得注意的是，有效的沙盒需要 *同时* 具备文件系统和网络隔离。没有网络隔离，受损的 Agent 可能泄露 SSH 密钥等敏感文件；没有文件系统隔离，受损的 Agent 可以轻易逃离沙盒并获得网络访问权限。通过同时使用这两种技术，我们可以为 Claude Code 用户提供更安全的代理体验。

### Claude Code 中的两个新沙盒功能

#### 沙盒化 bash 工具：无需权限提示的安全 bash 执行

今天，我们推出了一个新的沙盒运行时（研究预览版），它可以让你准确定义 Agent 可以访问哪些目录和网络主机，而无需启动和管理容器的开销。这可以用于沙盒化任意进程、Agent 和 MCP 服务器。它现在作为一个开源研究预览版在此处提供：[Github 链接?]

在 Claude Code 中，我们使用此运行时对 bash 工具进行沙盒化，允许 Claude 在你设置的定义限制内运行命令。这些命令默认更安全，它们需要的用户权限提示更少，因此 Claude 可以更自主地运行。如果 Claude 试图访问沙盒 *之外* 的东西，你会立即收到通知，并可以选择是否允许。

我们在 OS 级别原语之上构建了这一点，例如 [Linux bubblewrap](https://github.com/containers/bubblewrap) 和 MacOS seatbelt，以在 OS 级别强制执行这些限制。它们不仅涵盖 Claude Code 的直接交互，还涵盖由命令生成的任何脚本、程序或子进程。

如上所述，此沙盒强制执行：

1.  **文件系统隔离**，允许对当前工作目录的读写访问，但阻止修改其之外的任何文件。
2.  **网络隔离**，仅允许通过连接到沙盒外运行的代理服务器的 unix 域套接字进行互联网访问。此代理服务器强制执行进程可以连接到的域的限制，并处理用户对新请求域的确认。如果你想要进一步提高安全性，我们甚至支持自定义此代理以对传出流量强制执行任意规则。

这两个组件都是可配置的：你可以轻松选择允许或禁止特定的文件路径或域。

沙盒确保即使成功的提示词注入也被完全隔离，无法影响整体用户安全。这样，受损的 Claude Code 就无法窃取你的 SSH 密钥，或回连攻击者的服务器。

要开始使用此功能，请运行：`claude --sandbox`，并在此处阅读有关我们安全模型的更多技术细节。

为了让其他团队更容易构建更安全的 Agent，我们已经开源了 [XXX]。我们认为其他 AI 公司应该考虑为其自己的 Agent 采用这项技术，以增强其 Agent 的安全态势。

#### Claude Code on the web：在云端安全运行 Claude Code

今天，我们还发布了 [Claude Code on the web](TODO: Link to docs on CCR)，使用户能够在云端的隔离沙盒中运行 Claude Code。Claude Code on the web 在一个隔离的沙盒中执行每个 Claude Code 会话，在那里它可以安全可靠地完全访问其服务器。我们设计了这个沙盒，以确保证书（如 git 凭据或签名密钥）永远不会进入沙盒环境。这样，即使在沙盒中运行的代码受到损害，用户也能免受进一步伤害。

Claude Code on the web 使用自定义代理服务透明地处理所有 git 交互。在沙盒内部，git 客户端使用自定义构建的范围凭据向此服务进行身份验证。代理验证此凭据和 git 交互的内容（例如，确保它只推送到配置的分支），然后在将请求发送到 GitHub 之前附加正确的身份验证令牌。

## 开始使用

我们新的沙盒化 bash 工具和 Claude Code on the web 为使用 Claude 进行工程工作的开发者提供了安全性和生产力的实质性改进。

要开始使用这些工具：

1.  运行 `claude --sandbox` 并查看 [我们的文档](TODO) 了解如何配置此沙盒。
2.  前往 [claude.com/code](http://claude.ai/code) 试用 Claude Code on the web。

或者，如果你正在构建自己的 Agent，请查看我们开源的沙盒代码，并考虑将其集成到你的工作中。我们期待看到你的构建成果。
